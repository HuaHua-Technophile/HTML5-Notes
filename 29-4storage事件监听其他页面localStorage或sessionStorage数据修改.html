<!DOCTYPE html>
<html lang="zh-CN" data-bs-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="icon"
      href="https://i.328888.xyz/2023/04/14/ixDL13.jpeg"
      type="image/png" />
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <link
      href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.3.0-alpha3/css/bootstrap.css"
      rel="stylesheet" />
    <script src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.3.0-alpha3/js/bootstrap.bundle.js"></script>
    <title>
      29-4storage事件监听其他页面localStorage或sessionStorage数据修改
    </title>
  </head>
  <body>
    <p>web Storage支持事件通知机制，可以将数据更新的通知发送给监听者</p>
    <p>
      onstorage事件是当localStorage或sessionStorage中的数据被修改时，会在其他页面触发的事件
      <br />你可以通过window.onstorage或者addEventListener来监听这个事件，事件对象中包含了key,
      oldValue, newValue, url和storageArea等属性，可以用来获取存储数据的变化情况
    </p>
    <script>
      // !!!!!!!!!!该事件不在导致数据变化的当前页面触发（如果浏览器同时打开一个域名下面的多个页面，
      // 当其中的一个页面改变 localStorage 的数据时，
      // "其他所有页面的  storage  事件才会被触发，而原始页面并不触发 storage 事件"）
      window.onstorage = function (e) {
        console.log("另一个页面触发了storage事件");
        console.log("被修改的key：" + e.key);
        console.log("原值：" + e.oldValue);
        console.log("新值：" + e.newValue);
        console.log("引发变化的URL:" + e.url);
      };
    </script>
  </body>
</html>
